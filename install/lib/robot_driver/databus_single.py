#!/usr/bin/env python3
# 加密的DAS数据总线节点
import sys
import os
import base64
import types

# 设置路径
_script_dir = os.path.dirname(os.path.abspath(__file__))
if _script_dir not in sys.path:
  sys.path.insert(0, _script_dir)

# 编码的源码
ENCODED_SOURCE = '''
IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwojIOWcqOaWh+S7tuW8gOWktOa3u+WKoOi3r+W+hOWkhOeQhgppbXBvcnQgc3lzCmltcG9ydCBvcwoKIyDoh6rliqjmt7vliqDohJrmnKznm67lvZXliLBQeXRob27ot6/lvoQKc2NyaXB0X2RpciA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQppZiBzY3JpcHRfZGlyIG5vdCBpbiBzeXMucGF0aDoKICAgIHN5cy5wYXRoLmluc2VydCgwLCBzY3JpcHRfZGlyKQoKaW1wb3J0IHNlcmlhbAppbXBvcnQgc2VyaWFsLnRvb2xzLmxpc3RfcG9ydHMKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgdGltZQppbXBvcnQganNvbgppbXBvcnQgbG9nZ2luZwppbXBvcnQgcXVldWUKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgc3RydWN0CmltcG9ydCBvcwppbXBvcnQgc3VicHJvY2Vzcwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHBhY2sgaW1wb3J0IENtZFBhY2ssIE1lc3NhZ2VQYWNrLCBPcGNvZGUsIFJlY29yZFR5cGUKZnJvbSBkYXNfcHJvdG9jb2wgaW1wb3J0IERBU1Byb3RvY29sCgojIFJPU+ebuOWFs+WvvOWFpQppbXBvcnQgcm9zcHkKZnJvbSBzdGRfbXNncy5tc2cgaW1wb3J0IEZsb2F0MzIsIEludDhNdWx0aUFycmF5LCBJbnQxNk11bHRpQXJyYXksIE11bHRpQXJyYXlMYXlvdXQsIE11bHRpQXJyYXlEaW1lbnNpb24KCiMg5YWo5bGA5Y+Y6YeP55So5LqO5a2Y5YKodG9waWPlkI3np7AKVE9QSUNfTEVGVF9UQUNUSUxFID0gJy9kYXNfY29udHJvbGxlci90YWN0aWxlX3NpbmdsZV9sJwpUT1BJQ19SSUdIVF9UQUNUSUxFID0gJy9kYXNfY29udHJvbGxlci90YWN0aWxlX3NpbmdsZV9yJwpUT1BJQ19FTkNPREVSID0gJy9kYXNfY29udHJvbGxlci9lbmNvZGVyX2RhdGEnClRPUElDX1RBUkdFVF9ESVNUQU5DRSA9ICcvZGFzX2NvbnRyb2xsZXIvdGFyZ2V0X2RpcycKCmRlZiBsb2FkX3Jvc19wYXJhbXMoKToKICAgICIiIuS7jlJPU+WPguaVsOacjeWKoeWZqOWKoOi9vXRvcGlj6YWN572uIiIiCiAgICBnbG9iYWwgVE9QSUNfTEVGVF9UQUNUSUxFLCBUT1BJQ19SSUdIVF9UQUNUSUxFLCBUT1BJQ19FTkNPREVSLCBUT1BJQ19UQVJHRVRfRElTVEFOQ0UKICAgIAogICAgdHJ5OgogICAgICAgICMg6I635Y+W5Y+C5pWw77yM5L2/55So56eB5pyJ5ZG95ZCN56m66Ze0CiAgICAgICAgVE9QSUNfTEVGVF9UQUNUSUxFID0gcm9zcHkuZ2V0X3BhcmFtKCd+dG9waWNfbGVmdF90YWN0aWxlJywgJy9kYXNfY29udHJvbGxlci90YWN0aWxlX3NpbmdsZV9sJykKICAgICAgICBUT1BJQ19SSUdIVF9UQUNUSUxFID0gcm9zcHkuZ2V0X3BhcmFtKCd+dG9waWNfcmlnaHRfdGFjdGlsZScsICcvZGFzX2NvbnRyb2xsZXIvdGFjdGlsZV9zaW5nbGVfcicpCiAgICAgICAgVE9QSUNfRU5DT0RFUiA9IHJvc3B5LmdldF9wYXJhbSgnfnRvcGljX2VuY29kZXInLCAnL2Rhc19jb250cm9sbGVyL2VuY29kZXJfZGF0YScpCiAgICAgICAgVE9QSUNfVEFSR0VUX0RJU1RBTkNFID0gcm9zcHkuZ2V0X3BhcmFtKCd+dG9waWNfdGFyZ2V0X2Rpc3RhbmNlJywgJy9kYXNfY29udHJvbGxlci90YXJnZXRfZGlzJykKICAgICAgICAKICAgICAgICAjIHJvc3B5LmxvZ2luZm8oIkRBUyB0b3BpY+mFjee9ruWKoOi9veWujOaIkDoiKQogICAgICAgICMgcm9zcHkubG9naW5mbyhmIiAg5bem6Kem6KeJOiB7VE9QSUNfTEVGVF9UQUNUSUxFfSIpCiAgICAgICAgIyByb3NweS5sb2dpbmZvKGYiICDlj7Pop6bop4k6IHtUT1BJQ19SSUdIVF9UQUNUSUxFfSIpCiAgICAgICAgIyByb3NweS5sb2dpbmZvKGYiICDnvJbnoIHlmag6IHtUT1BJQ19FTkNPREVSfSIpCiAgICAgICAgIyByb3NweS5sb2dpbmZvKGYiICDnm67moIfot53nprs6IHtUT1BJQ19UQVJHRVRfRElTVEFOQ0V9IikKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAjIHJvc3B5LmxvZ3dhcm4oZiLliqDovb1ST1Plj4LmlbDlpLHotKXvvIzkvb/nlKjpu5jorqTlgLw6IHtlfSIpCiAgICAgICAgcGFzcwoKZGVmIHRhY3RpbGVfY2FsbGJhY2socmVjb3JkX2RhdGE6IGJ5dGVzKToKICAgICMgcHJpbnQoInRhY3RpbGUgZGF0YTogbGVuOiB7fSIuZm9ybWF0KGxlbihyZWNvcmRfZGF0YSkpKQogICAgIyDkv67mraPvvJrnoazku7blrp7pmYXmjqXmlLY0NDjlrZfoioLvvIzmlLnlm57mraPnoa7nmoTplb/luqbmo4Dmn6UKICAgIGlmIGxlbihyZWNvcmRfZGF0YSkgIT0gNDQ4OgogICAgICAgIHByaW50KGYi5pWw5o2u6ZW/5bqm6ZSZ6K+vOiDmnJ/mnJs0NDjlrZfoioIsIOWunumZhXtsZW4ocmVjb3JkX2RhdGEpfeWtl+iKgiIpCiAgICAgICAgcmV0dXJuCgogICAgaWYgbm90IGhhc2F0dHIodGFjdGlsZV9jYWxsYmFjaywgInB1Yl9pbml0aWFsaXplZCIpOgogICAgICAgICMg5LuO5YWo5bGA5Y+Y6YeP6I635Y+WdG9waWPlkI3np7AKICAgICAgICBsb2FkX3Jvc19wYXJhbXMoKQogICAgICAgIHRhY3RpbGVfY2FsbGJhY2subGVmdF9wdWJsaXNoZXJfdWludDggPSByb3NweS5QdWJsaXNoZXIoVE9QSUNfTEVGVF9UQUNUSUxFLCBJbnQ4TXVsdGlBcnJheSwgcXVldWVfc2l6ZT0xMCkKICAgICAgICB0YWN0aWxlX2NhbGxiYWNrLnJpZ2h0X3B1Ymxpc2hlcl91aW50OCA9IHJvc3B5LlB1Ymxpc2hlcihUT1BJQ19SSUdIVF9UQUNUSUxFLCBJbnQ4TXVsdGlBcnJheSwgcXVldWVfc2l6ZT0xMCkKICAgICAgICB0YWN0aWxlX2NhbGxiYWNrLnB1Yl9pbml0aWFsaXplZCA9IFRydWUKICAgICAgICAjIHByaW50KGYi6Kem6KeJ5Lyg5oSf5Zmo5pWw5o2u5Y+R5biD5Zmo5bey5Yid5aeL5YyWIikKICAgICAgICAjIHByaW50KGYiICDlt6bkvKDmhJ/lmah0b3BpYzoge1RPUElDX0xFRlRfVEFDVElMRX0iKQogICAgICAgICMgcHJpbnQoZiIgIOWPs+S8oOaEn+WZqHRvcGljOiB7VE9QSUNfUklHSFRfVEFDVElMRX0iKQogICAgCiAgICB0cnk6CiAgICAgICAgIyAxLiDop6PmnpDljp/lp4s0NDjlrZfoioLmlbDmja7vvJrlt6bkvKDmhJ/lmagyMjTlrZfoioIoMC0yMjMp44CB5Y+z5Lyg5oSf5ZmoMjI05a2X6IqCKDIyNC00NDcpCiAgICAgICAgcmF3X2xlZnRfMjI0ID0gW3N0cnVjdC51bnBhY2soIkIiLCByZWNvcmRfZGF0YVtpOmkrMV0pWzBdIGZvciBpIGluIHJhbmdlKDAsIDIyNCldCiAgICAgICAgcmF3X3JpZ2h0XzIyNCA9IFtzdHJ1Y3QudW5wYWNrKCJCIiwgcmVjb3JkX2RhdGFbaTppKzFdKVswXSBmb3IgaSBpbiByYW5nZSgyMjQsIDQ0OCldCiAgICAgICAgCiAgICAgICAgIyBwcmludChmIuWOn+Wni+aVsOaNriAtIOW3puS8oOaEn+WZqDoge2xlbihyYXdfbGVmdF8yMjQpfeS4qiwg6IyD5Zu0OnttaW4ocmF3X2xlZnRfMjI0KX1+e21heChyYXdfbGVmdF8yMjQpfSIpCiAgICAgICAgIyBwcmludChmIuWOn+Wni+aVsOaNriAtIOWPs+S8oOaEn+WZqDoge2xlbihyYXdfcmlnaHRfMjI0KX3kuKosIOiMg+WbtDp7bWluKHJhd19yaWdodF8yMjQpfX57bWF4KHJhd19yaWdodF8yMjQpfSIpCgogICAgICAgICMgMi4g5qC45b+D77ya5Y6f5aeL5pWw5o2uMeaLhjLvvIjlpI3liLbmianlsZXvvInvvIzlvpfliLA4OTbkuKrmnInmlYjmlbDmja7vvIgyMjTDlzIgKyAyMjTDlzLvvIkKICAgICAgICBsZWZ0X2V4cGFuZGVkXzQ0OCA9IFtdCiAgICAgICAgZm9yIHZhbCBpbiByYXdfbGVmdF8yMjQ6CiAgICAgICAgICAgIGxlZnRfZXhwYW5kZWRfNDQ4LmFwcGVuZCh2YWwpICAjIOWOn+aVsOaNrgogICAgICAgICAgICBsZWZ0X2V4cGFuZGVkXzQ0OC5hcHBlbmQodmFsKSAgIyDlpI3liLbmlbDmja7vvIjmjInljovlkIzmraXlj5jljJbvvIkKICAgICAgICAKICAgICAgICByaWdodF9leHBhbmRlZF80NDggPSBbXQogICAgICAgIGZvciB2YWwgaW4gcmF3X3JpZ2h0XzIyNDoKICAgICAgICAgICAgcmlnaHRfZXhwYW5kZWRfNDQ4LmFwcGVuZCh2YWwpICAjIOWOn+aVsOaNrgogICAgICAgICAgICByaWdodF9leHBhbmRlZF80NDguYXBwZW5kKHZhbCkgICMg5aSN5Yi25pWw5o2u77yI5oyJ5Y6L5ZCM5q2l5Y+Y5YyW77yJCgogICAgICAgICMgMy4g5Yid5aeL5YyWMTAw6KGMw5cxMOWIl+aAu+e9keagvO+8iDAtNDnooYw95bem5Lyg5oSf5Zmo77yMNTAtOTnooYw95Y+z5Lyg5oSf5Zmo77yJCiAgICAgICAgdG90YWxfZ3JpZCA9IFtbMCBmb3IgXyBpbiByYW5nZSgxMCldIGZvciBfIGluIHJhbmdlKDEwMCldCgogICAgICAgICMgNC4g5a6a5LmJ5omA5pyJ6ZyA6KaB5aGr5YWF6LSf5pWwKC0xKeeahOWdkOagh++8iOaMieWOi+aXoOWPmOWMlu+8iQogICAgICAgICMgNC4xIOW3puS8oOaEn+WZqO+8iDAtNDnooYzvvInotJ/mlbDlnZDmoIcKICAgICAgICBsZWZ0X25lZ19jb29yZHMgPSBbCiAgICAgICAgICAgICMg5bem5LiK6KeSCiAgICAgICAgICAgICgwLDApLCAoMCwxKSwgKDAsMiksICgxLDApLCAoMSwxKSwgKDIsMCksCiAgICAgICAgICAgICMg5Y+z5LiK6KeSCiAgICAgICAgICAgICgwLDcpLCAoMCw4KSwgKDAsOSksICgxLDgpLCAoMSw5KSwgKDIsOSksCiAgICAgICAgICAgICMg5bem5LiL6KeSCiAgICAgICAgICAgICg0OSwwKSwgKDQ5LDEpLCAoNDksMiksICg0OSwzKSwKICAgICAgICAgICAgKDQ4LDApLCAoNDgsMSksICg0OCwyKSwgKDQ4LDMpLAogICAgICAgICAgICAoNDcsMCksICg0NywxKSwgKDQ3LDIpLAogICAgICAgICAgICAoNDYsMCksICg0NiwxKSwgKDQ2LDIpLAogICAgICAgICAgICAoNDUsMCksICg0NSwxKSwgKDQ1LDIpLAogICAgICAgICAgICAoNDQsMCksICg0NCwxKSwKICAgICAgICAgICAgKDQzLDApLAogICAgICAgICAgICAjIOWPs+S4i+inkgogICAgICAgICAgICAoNDksNiksICg0OSw3KSwgKDQ5LDgpLCAoNDksOSksCiAgICAgICAgICAgICg0OCw2KSwgKDQ4LDcpLCAoNDgsOCksICg0OCw5KSwKICAgICAgICAgICAgKDQ3LDcpLCAoNDcsOCksICg0Nyw5KSwKICAgICAgICAgICAgKDQ2LDcpLCAoNDYsOCksICg0Niw5KSwKICAgICAgICAgICAgKDQ1LDcpLCAoNDUsOCksICg0NSw5KSwKICAgICAgICAgICAgKDQ0LDgpLCAoNDQsOSksCiAgICAgICAgICAgICg0Myw5KQogICAgICAgIF0KCiAgICAgICAgIyA0LjIg5Y+z5Lyg5oSf5Zmo77yINTAtOTnooYzvvInotJ/mlbDlnZDmoIcKICAgICAgICByaWdodF9uZWdfY29vcmRzID0gWwogICAgICAgICAgICAjIOW3puS4iuinkgogICAgICAgICAgICAoNTAsMCksICg1MCwxKSwgKDUwLDIpLCAoNTEsMCksICg1MSwxKSwgKDUyLDApLAogICAgICAgICAgICAjIOWPs+S4iuinkgogICAgICAgICAgICAoNTAsNyksICg1MCw4KSwgKDUwLDkpLCAoNTEsOCksICg1MSw5KSwgKDUyLDkpLAogICAgICAgICAgICAjIOW3puS4i+inkgogICAgICAgICAgICAoOTksMCksICg5OSwxKSwgKDk5LDIpLCAoOTksMyksCiAgICAgICAgICAgICg5OCwwKSwgKDk4LDEpLCAoOTgsMiksICg5OCwzKSwKICAgICAgICAgICAgKDk3LDApLCAoOTcsMSksICg5NywyKSwKICAgICAgICAgICAgKDk2LDApLCAoOTYsMSksICg5NiwyKSwKICAgICAgICAgICAgKDk1LDApLCAoOTUsMSksICg5NSwyKSwKICAgICAgICAgICAgKDk0LDApLCAoOTQsMSksCiAgICAgICAgICAgICg5MywwKSwKICAgICAgICAgICAgIyDlj7PkuIvop5IKICAgICAgICAgICAgKDk5LDYpLCAoOTksNyksICg5OSw4KSwgKDk5LDkpLAogICAgICAgICAgICAoOTgsNiksICg5OCw3KSwgKDk4LDgpLCAoOTgsOSksCiAgICAgICAgICAgICg5Nyw3KSwgKDk3LDgpLCAoOTcsOSksCiAgICAgICAgICAgICg5Niw3KSwgKDk2LDgpLCAoOTYsOSksCiAgICAgICAgICAgICg5NSw3KSwgKDk1LDgpLCAoOTUsOSksCiAgICAgICAgICAgICg5NCw4KSwgKDk0LDkpLAogICAgICAgICAgICAoOTMsOSkKICAgICAgICBdCgogICAgICAgICMgNS4g5aGr5YWF6LSf5pWw5Z2Q5qCH77yI5Zu65a6aLTHvvIzmjInljovml6Dlj5jljJbvvIkKICAgICAgICBmb3IgKHIsIGMpIGluIGxlZnRfbmVnX2Nvb3JkczoKICAgICAgICAgICAgdG90YWxfZ3JpZFtyXVtjXSA9IC0xCiAgICAgICAgZm9yIChyLCBjKSBpbiByaWdodF9uZWdfY29vcmRzOgogICAgICAgICAgICB0b3RhbF9ncmlkW3JdW2NdID0gLTEKCiAgICAgICAgIyA2LiDmjIki5LuO5bem5Yiw5Y+z44CB5LuO5LiK5Yiw5LiLIumhuuW6j+Whq+WFheaJqeWxleWQjueahOaVsOaNru+8iOaMieWOi+acieWPmOWMlu+8iQogICAgICAgICMgNi4xIOWhq+WFheW3puS8oOaEn+WZqO+8iDAtNDnooYzvvInmnInmlYjkvY3nva4KICAgICAgICBsZWZ0X2lkeCA9IDAKICAgICAgICBmb3Igcm93IGluIHJhbmdlKDUwKTogICAgICAgICAgIyDpgY3ljoYwLTQ56KGMCiAgICAgICAgICAgIGZvciBjb2wgaW4gcmFuZ2UoMTApOiAgICAgICMg6YGN5Y6GMC055YiX77yI5LuO5bem5Yiw5Y+z77yJCiAgICAgICAgICAgICAgICBpZiB0b3RhbF9ncmlkW3Jvd11bY29sXSAhPSAtMSBhbmQgbGVmdF9pZHggPCBsZW4obGVmdF9leHBhbmRlZF80NDgpOgogICAgICAgICAgICAgICAgICAgIHRvdGFsX2dyaWRbcm93XVtjb2xdID0gbGVmdF9leHBhbmRlZF80NDhbbGVmdF9pZHhdCiAgICAgICAgICAgICAgICAgICAgbGVmdF9pZHggKz0gMQoKICAgICAgICAjIDYuMiDloavlhYXlj7PkvKDmhJ/lmajvvIg1MC05OeihjO+8ieacieaViOS9jee9rgogICAgICAgIHJpZ2h0X2lkeCA9IDAKICAgICAgICBmb3Igcm93IGluIHJhbmdlKDUwLCAxMDApOiAgICAgIyDpgY3ljoY1MC05OeihjAogICAgICAgICAgICBmb3IgY29sIGluIHJhbmdlKDEwKTogICAgICAjIOmBjeWOhjAtOeWIl++8iOS7juW3puWIsOWPs++8iQogICAgICAgICAgICAgICAgaWYgdG90YWxfZ3JpZFtyb3ddW2NvbF0gIT0gLTEgYW5kIHJpZ2h0X2lkeCA8IGxlbihyaWdodF9leHBhbmRlZF80NDgpOgogICAgICAgICAgICAgICAgICAgIHRvdGFsX2dyaWRbcm93XVtjb2xdID0gcmlnaHRfZXhwYW5kZWRfNDQ4W3JpZ2h0X2lkeF0KICAgICAgICAgICAgICAgICAgICByaWdodF9pZHggKz0gMQoKICAgICAgICAjIDguIOaLhuWIhue9keagvOS4uuW3puWPs+S8oOaEn+WZqOaVsOaNru+8jOWxleW5s+WQjuWPkeW4g+WIsFJPUwogICAgICAgICMgOC4xIOW3puS8oOaEn+WZqOWxleW5s++8iDAtNDnooYwg4oaSIDUwMOS4quaVsOaNru+8iQogICAgICAgIGxlZnRfZmxhdCA9IFtdCiAgICAgICAgZm9yIHJvdyBpbiByYW5nZSg1MCk6CiAgICAgICAgICAgIGxlZnRfZmxhdC5leHRlbmQodG90YWxfZ3JpZFtyb3ddKQogICAgICAgIAogICAgICAgICMgOC4yIOWPs+S8oOaEn+WZqOWxleW5s++8iDUwLTk56KGMIOKGkiA1MDDkuKrmlbDmja7vvIkKICAgICAgICByaWdodF9mbGF0ID0gW10KICAgICAgICBmb3Igcm93IGluIHJhbmdlKDUwLCAxMDApOgogICAgICAgICAgICByaWdodF9mbGF0LmV4dGVuZCh0b3RhbF9ncmlkW3Jvd10pCgogICAgICAgICMg6L2s5o2i5Li65pyJ56ym5Y+3OOS9jeaVtOaVsO+8iFJPU+aXoFVJbnQ4TXVsdGlBcnJhee+8jOi0n+aVsC0x5L+d55WZ77yJCiAgICAgICAgbXNnX2xlZnQgPSBJbnQ4TXVsdGlBcnJheSgpCiAgICAgICAgbXNnX2xlZnQuZGF0YSA9IFt4IGlmIHggPT0gLTEgZWxzZSAoeCBpZiB4IDwgMTI4IGVsc2UgeCAtIDI1NikgZm9yIHggaW4gbGVmdF9mbGF0XQogICAgICAgIAogICAgICAgIG1zZ19yaWdodCA9IEludDhNdWx0aUFycmF5KCkKICAgICAgICBtc2dfcmlnaHQuZGF0YSA9IFt4IGlmIHggPT0gLTEgZWxzZSAoeCBpZiB4IDwgMTI4IGVsc2UgeCAtIDI1NikgZm9yIHggaW4gcmlnaHRfZmxhdF0KCiAgICAgICAgIyDlj5HluINST1Pmtojmga8KICAgICAgICB0YWN0aWxlX2NhbGxiYWNrLmxlZnRfcHVibGlzaGVyX3VpbnQ4LnB1Ymxpc2gobXNnX2xlZnQpCiAgICAgICAgdGFjdGlsZV9jYWxsYmFjay5yaWdodF9wdWJsaXNoZXJfdWludDgucHVibGlzaChtc2dfcmlnaHQpCgogICAgICAgICMg5omT5Y2w5Y+R5biD57uf6K6hCiAgICAgICAgbGVmdF9uZWdfY291bnQgPSBzdW0oMSBmb3IgeCBpbiBsZWZ0X2ZsYXQgaWYgeCA9PSAtMSkKICAgICAgICByaWdodF9uZWdfY291bnQgPSBzdW0oMSBmb3IgeCBpbiByaWdodF9mbGF0IGlmIHggPT0gLTEpCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLlpITnkIbop6bop4nmlbDmja7plJnor686IHtlfSIpCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCgpkZWYgZW5jb2Rlcl9jYWxsYmFjayhyZWNvcmRfZGF0YTogYnl0ZXMpOgogICAgIyDliJvlu7pST1Plj5HluIPlmajvvIjljZXkvovmqKHlvI/vvIkKICAgIGlmIG5vdCBoYXNhdHRyKGVuY29kZXJfY2FsbGJhY2ssICJwdWJfaW5pdGlhbGl6ZWQiKToKICAgICAgICAjIOS7juWFqOWxgOWPmOmHj+iOt+WPlnRvcGlj5ZCN56ewCiAgICAgICAgbG9hZF9yb3NfcGFyYW1zKCkKICAgICAgICBlbmNvZGVyX2NhbGxiYWNrLnB1Ymxpc2hlciA9IHJvc3B5LlB1Ymxpc2hlcihUT1BJQ19FTkNPREVSLCBGbG9hdDMyLCBxdWV1ZV9zaXplPTEwKQogICAgICAgIGVuY29kZXJfY2FsbGJhY2sucHViX2luaXRpYWxpemVkID0gVHJ1ZQogICAgICAgICMgcHJpbnQoZiLnvJbnoIHlmajmlbDmja7lj5HluIPlmajlt7LliJ3lp4vljJY6IHtUT1BJQ19FTkNPREVSfSIpCiAgICAKICAgIGVuY29kZXJfdmFsdWUgPSBzdHJ1Y3QudW5wYWNrKCI+ZiIsIHJlY29yZF9kYXRhKVswXQogICAgIyBwcmludCgKICAgICMgICAgICJlbmNvZGVyIGRhdGE6IHt9LCBsZW46IHt9LCBlbmNvZGVyX3ZhbHVlOiB7fSIuZm9ybWF0KAogICAgIyAgICAgICAgIHJlY29yZF9kYXRhLCBsZW4ocmVjb3JkX2RhdGEpLCBlbmNvZGVyX3ZhbHVlCiAgICAjICAgICApCiAgICAjICkKICAgIAogICAgIyDlj5HluIPnvJbnoIHlmajmlbDmja7liLBST1Por53popgKICAgIHRyeToKICAgICAgICBtc2cgPSBGbG9hdDMyKCkKICAgICAgICBtc2cuZGF0YSA9IGVuY29kZXJfdmFsdWUKICAgICAgICBlbmNvZGVyX2NhbGxiYWNrLnB1Ymxpc2hlci5wdWJsaXNoKG1zZykKICAgICAgICAjIHByaW50KGYi5Y+R5biD57yW56CB5Zmo5pWw5o2uOiB7ZW5jb2Rlcl92YWx1ZX0iKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi5Y+R5biD57yW56CB5Zmo5pWw5o2u5pe25Ye66ZSZOiB7ZX0iKQoKZGVmIGVjaG9fY2FsbGJhY2socmVjb3JkX2RhdGE6IGJ5dGVzKToKICAgIHByaW50KCJlY2hvIGRhdGE6IHt9Ii5mb3JtYXQocmVjb3JkX2RhdGEpKQoKZGVmIGNhbWVyYV9jYWxpYl9jYWxsYmFjayhjYW1lcmFfcGFjayk6CiAgICAiIiLmkYTlg4/lpLTmoIflrprmlbDmja7lm57osIPlh73mlbAiIiIKICAgICMgcHJpbnQoImNhbWVyYV9wYWNrIHJlY2VpdmVkOiAiLCBjYW1lcmFfcGFjaykKICAgICMgaWYgY2FtZXJhX3BhY2s6CiAgICAjICAgICBwcmludCgi4pyFIOaRhOWDj+WktOagh+WumuaVsOaNruino+aekOaIkOWKnyIpCiAgICAjIGVsc2U6CiAgICAjICAgICBwcmludCgi4p2MIOaRhOWDj+WktOagh+WumuaVsOaNruino+aekOWksei0pSIpCgpjbGFzcyBEYXRhQnVzOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgdHR5X3BvcnQ9Ii9kZXYvdHR5VVNCMCIsCiAgICAgICAgYmF1ZHJhdGU9MTE1MjAwLAogICAgICAgIHRpbWVvdXQ9MC41LAogICAgICAgIGlzX2NhbGliX2NtZD1GYWxzZSwKICAgICAgICBlbmNvZGVyX2ZyZXE6IGZsb2F0ID0gTm9uZSwKICAgICAgICB0YWN0aWxlX2ZyZXE6IGZsb2F0ID0gTm9uZSwKICAgICk6CiAgICAgICAgIyDliJ3lp4vljJZST1PoioLngrkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJvc3B5LmluaXRfbm9kZSgnZGFzX3Jvc19pbnRlcmZhY2UnLCBhbm9ueW1vdXM9VHJ1ZSkKICAgICAgICBleGNlcHQgcm9zcHkuZXhjZXB0aW9ucy5ST1NFeGNlcHRpb246CiAgICAgICAgICAgICMg5aaC5p6c5bey57uP5Yid5aeL5YyW77yM5Y+q6I635Y+W6IqC54K55ZCNCiAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICAjIOWKoOi9vXRvcGlj6YWN572uCiAgICAgICAgbG9hZF9yb3NfcGFyYW1zKCkKICAgICAgICAKICAgICAgICBzZWxmLnR0eV9wb3J0ID0gdHR5X3BvcnQKICAgICAgICBzZWxmLmJhdWRyYXRlID0gYmF1ZHJhdGUKICAgICAgICBzZWxmLnRpbWVvdXQgPSB0aW1lb3V0CiAgICAgICAgc2VsZi5zZXIgPSBOb25lCiAgICAgICAgc2VsZi5pc19ydW5uaW5nID0gRmFsc2UKCiAgICAgICAgc2VsZi5fb3Blbl9zZXJpYWxfc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgc2VsZi5wcm90b2NvbDogREFTUHJvdG9jb2wgPSBEQVNQcm90b2NvbCgpCiAgICAgICAgc2VsZi5kYXRhX2J1ZmZlcjogYnl0ZXMgPSBiIiIKICAgICAgICBzZWxmLmRhdGFfYnVmZmVyX2xvY2sgPSB0aHJlYWRpbmcuTG9jaygpCiAgICAgICAgc2VsZi5zZXJpYWxfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKCiAgICAgICAgc2VsZi5jbWRfcXVldWUgPSBxdWV1ZS5RdWV1ZSgxMDAwKQoKICAgICAgICBzZWxmLnJlYWRfdGhyZWFkOiB0aHJlYWRpbmcuVGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYucGFyc2VfdGhyZWFkOiB0aHJlYWRpbmcuVGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYuc2VuZF90aHJlYWQ6IHRocmVhZGluZy5UaHJlYWQgPSBOb25lCgogICAgICAgIHNlbGYuZW5jb2Rlcl9mcmVxID0gZW5jb2Rlcl9mcmVxCiAgICAgICAgc2VsZi50YWN0aWxlX2ZyZXEgPSB0YWN0aWxlX2ZyZXEKICAgICAgICBzZWxmLmVuY29kZXJfdGhyZWFkOiB0aHJlYWRpbmcuVGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYudGFjdGlsZV90aHJlYWQ6IHRocmVhZGluZy5UaHJlYWQgPSBOb25lCiAgICAgICAgCiAgICAgICAgc2VsZi5ncmlwcGVyX2RpcyA9IDAuMAogICAgICAgIHNlbGYuYW5nbGVfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKICAgICAgICAjIOa3u+WKoOaRhOWDj+WktOagh+WumuWRveS7pOagh+W/lwogICAgICAgIHNlbGYuaXNfY2FsaWJfY21kID0gaXNfY2FsaWJfY21kICAjIOm7mOiupOS4ukZhbHNlCiAgICAgICAgc2VsZi50YWN0aWxlX2NhbGxiYWNrID0gdGFjdGlsZV9jYWxsYmFjawogICAgICAgIHNlbGYuZW5jb2Rlcl9jYWxsYmFjayA9IGVuY29kZXJfY2FsbGJhY2sKICAgICAgICBzZWxmLmVjaG9fY2FsbGJhY2sgPSBlY2hvX2NhbGxiYWNrCiAgICAgICAgc2VsZi5jYW1lcmFfY2FsaWJfY2FsbGJhY2sgPSBjYW1lcmFfY2FsaWJfY2FsbGJhY2sgICMg5paw5aKe5pGE5YOP5aS05qCH5a6a5Zue6LCDCgogICAgICAgICMg5Yid5aeL5YyWUk9T6K6i6ZiF5ZmoCiAgICAgICAgc2VsZi5faW5pdF9yb3Nfc3Vic2NyaWJlcnMoKQoKICAgICAgICBzZWxmLl9vcGVuX3NlcmlhbCgpCiAgICAgICAgc2VsZi5pc19ydW5uaW5nID0gVHJ1ZQogICAgICAgIHNlbGYuX3N0YXJ0X3JlYWRpbmcoKQogICAgICAgIHNlbGYuX3N0YXJ0X3BhcnNpbmcoKQogICAgICAgIHNlbGYuX3N0YXJ0X3NlbmRpbmcoKQogICAgICAgIAogICAgICAgICMg5ZCv5Yqo5b6q546v57q/56iLCiAgICAgICAgaWYgc2VsZi5lbmNvZGVyX2ZyZXE6CiAgICAgICAgICAgIHNlbGYuX3N0YXJ0X2VuY29kZXJfbG9vcCgpCiAgICAgICAgaWYgc2VsZi50YWN0aWxlX2ZyZXE6CiAgICAgICAgICAgIHNlbGYuX3N0YXJ0X3RhY3RpbGVfbG9vcCgpCgogICAgZGVmIF9pbml0X3Jvc19zdWJzY3JpYmVycyhzZWxmKToKICAgICAgICAiIiLliJ3lp4vljJZST1PorqLpmIXlmagiIiIKICAgICAgICAjIOiuoumYheWkueeIquW8gOWQiOW6puaMh+S7pAogICAgICAgIHNlbGYubW90b3JfY21kX3N1YnNjcmliZXIgPSByb3NweS5TdWJzY3JpYmVyKAogICAgICAgICAgICBUT1BJQ19UQVJHRVRfRElTVEFOQ0UsIAogICAgICAgICAgICBGbG9hdDMyLCAKICAgICAgICAgICAgc2VsZi5fbW90b3JfY29tbWFuZF9jYWxsYmFjawogICAgICAgICkKICAgICAgICAjIHByaW50KGYiUk9T6K6i6ZiF5Zmo5bey5Yid5aeL5YyW77yae1RPUElDX1RBUkdFVF9ESVNUQU5DRX0iKQoKICAgIGRlZiBfbW90b3JfY29tbWFuZF9jYWxsYmFjayhzZWxmLCBtc2cpOgogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBzZWxmLmFuZ2xlX2xvY2s6CiAgICAgICAgICAgICAgICBzZWxmLmdyaXBwZXJfZGlzID0gbXNnLmRhdGEKICAgICAgICAgICAgIyBwcmludChmIuS4i+WPkeW8gOW6puaMh+S7pDoge21zZy5kYXRhfSBtIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi5aSE55CG55S15py65oyH5Luk5pe25Ye66ZSZOiB7ZX0iKQoKICAgIGRlZiBkcml2ZV9tb3RvcihzZWxmLCBhbmdsZV9kZ3JlZTogZmxvYXQpOgogICAgICAgIHNlbGYuYWRkX2NtZCgKICAgICAgICAgICAgQ21kUGFjay5wYWNrKAogICAgICAgICAgICAgICAgb3Bjb2RlPU9wY29kZS5Xcml0ZURyaXZlLAogICAgICAgICAgICAgICAgcmVjb3JkX3R5cGU9UmVjb3JkVHlwZS5Ecml2ZSwKICAgICAgICAgICAgICAgIHJlY29yZD1zdHJ1Y3QucGFjaygiPmYiLCBhbmdsZV9kZ3JlZSksCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgZGVmIGRpc2FibGVfbW90b3Ioc2VsZik6CiAgICAgICAgc2VsZi5hZGRfY21kKAogICAgICAgICAgICBDbWRQYWNrLnBhY2soCiAgICAgICAgICAgICAgICBvcGNvZGU9T3Bjb2RlLkRpc2FibGVEcml2ZSwKICAgICAgICAgICAgICAgIHJlY29yZF90eXBlPVJlY29yZFR5cGUuRHJpdmUsCiAgICAgICAgICAgICkKICAgICAgICApCiAgICAKICAgIGRlZiBjYWxpYl9lbmNvZGVyKHNlbGYpOgogICAgICAgIHNlbGYuYWRkX2NtZCgKICAgICAgICAgICAgQ21kUGFjay5wYWNrKAogICAgICAgICAgICAgICAgb3Bjb2RlPU9wY29kZS5DYWxpYkVuY29kZXIsCiAgICAgICAgICAgICAgICByZWNvcmRfdHlwZT1SZWNvcmRUeXBlLkRyaXZlLAogICAgICAgICAgICApCiAgICAgICAgKQoKICAgIGRlZiBzZW5kX2NhbWVyYV9jYWxpYl9jbWQoc2VsZiwgY2FtZXJhX2NtZDogc3RyKToKICAgICAgICAiIiLlj5HpgIHmkYTlg4/lpLTmoIflrprlkb3ku6QiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNtZCA9IENtZFBhY2sucGFja19jYWxpYigKICAgICAgICAgICAgICAgIHJlY29yZD1jYW1lcmFfY21kLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICApCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBzZWxmLmFkZF9jbWQoY21kKQogICAgICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICAgICAgcHJpbnQoZiLlj5HpgIHmkYTlg4/lpLTmoIflrprlkb3ku6Q6IHtjYW1lcmFfY21kfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIuWPkemAgeaRhOWDj+WktOagh+WumuWRveS7pOWksei0pToge2NhbWVyYV9jbWR9IikKICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi5Y+R6YCB5pGE5YOP5aS05qCH5a6a5ZG95Luk5pe25Ye66ZSZOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgYWRkX2NtZChzZWxmLCBjbWQ6IENtZFBhY2spIC0+IGJvb2w6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmNtZF9xdWV1ZS5wdXQoY21kLCBibG9jaz1UcnVlLCB0aW1lb3V0PTEpCiAgICAgICAgICAgICMgcHJpbnQoZiLlkb3ku6Tmt7vliqDliLDpmJ/liJfvvIzlvZPliY3pmJ/liJflpKflsI86IHtzZWxmLmNtZF9xdWV1ZS5xc2l6ZSgpfSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0IHF1ZXVlLkZ1bGw6CiAgICAgICAgICAgIHByaW50KCLlkb3ku6TpmJ/liJflt7Lmu6HvvIzmt7vliqDlpLHotKUiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgaXNfb3BlbmQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuX29wZW5fc2VyaWFsX3N1Y2Nlc3MKCiAgICBkZWYgcmVnaXN0ZXJfdGFjdGlsZV9jYWxsYmFjayhzZWxmLCBjYWxsYmFjayk6CiAgICAgICAgc2VsZi50YWN0aWxlX2NhbGxiYWNrID0gY2FsbGJhY2sKCiAgICBkZWYgcmVnaXN0ZXJfZW5jb2Rlcl9jYWxsYmFjayhzZWxmLCBjYWxsYmFjayk6CiAgICAgICAgc2VsZi5lbmNvZGVyX2NhbGxiYWNrID0gY2FsbGJhY2sKCiAgICBkZWYgcmVnaXN0ZXJfY2FtZXJhX2NhbGliX2NhbGxiYWNrKHNlbGYsIGNhbGxiYWNrKToKICAgICAgICAiIiLms6jlhozmkYTlg4/lpLTmoIflrprmlbDmja7lm57osIPlh73mlbAiIiIKICAgICAgICBzZWxmLmNhbWVyYV9jYWxpYl9jYWxsYmFjayA9IGNhbGxiYWNrCgogICAgZGVmIF9vcGVuX3NlcmlhbChzZWxmKToKICAgICAgICBzZWxmLnNlciA9IHNlcmlhbC5TZXJpYWwoCiAgICAgICAgICAgIHBvcnQ9c2VsZi50dHlfcG9ydCwKICAgICAgICAgICAgYmF1ZHJhdGU9c2VsZi5iYXVkcmF0ZSwKICAgICAgICAgICAgdGltZW91dD1zZWxmLnRpbWVvdXQsCiAgICAgICAgICAgIHBhcml0eT1zZXJpYWwuUEFSSVRZX05PTkUsCiAgICAgICAgICAgIHN0b3BiaXRzPXNlcmlhbC5TVE9QQklUU19PTkUsCiAgICAgICAgICAgIGJ5dGVzaXplPXNlcmlhbC5FSUdIVEJJVFMsCiAgICAgICAgKQoKICAgICAgICBpZiBzZWxmLnNlci5pc19vcGVuOgogICAgICAgICAgICBwcmludChmIm9wZW4ge3NlbGYudHR5X3BvcnR9IHN1Y2Nlc3MhLCBiYXVkcmF0ZToge3NlbGYuYmF1ZHJhdGV9IikKICAgICAgICAgICAgc2VsZi5fb3Blbl9zZXJpYWxfc3VjY2VzcyA9IFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIm9wZW4ge3NlbGYudHR5X3BvcnR9IGZhaWxlZCEsIGJhdWRyYXRlOiB7c2VsZi5iYXVkcmF0ZX0iKQogICAgICAgICAgICBzZWxmLl9vcGVuX3NlcmlhbF9zdWNjZXNzID0gRmFsc2UKCiAgICBkZWYgX3N0YXJ0X3JlYWRpbmcoc2VsZik6CiAgICAgICAgc2VsZi5yZWFkX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3JlYWRpbmdfbG9vcCkKICAgICAgICBzZWxmLnJlYWRfdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICBzZWxmLnJlYWRfdGhyZWFkLnN0YXJ0KCkKICAgICAgICAjIHByaW50KCLor7vlj5bnur/nqIvlt7LlkK/liqgiKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9zdGFydF9wYXJzaW5nKHNlbGYpOgogICAgICAgIHNlbGYucGFyc2VfdGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fcGFyc2luZ19sb29wKQogICAgICAgIHNlbGYucGFyc2VfdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICBzZWxmLnBhcnNlX3RocmVhZC5zdGFydCgpCiAgICAgICAgIyBwcmludCgi6Kej5p6Q57q/56iL5bey5ZCv5YqoIikKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBfc3RhcnRfZW5jb2Rlcl9sb29wKHNlbGYpOgogICAgICAgICIiIuato+ehruWQr+WKqOe8lueggeWZqOW+queOr+e6v+eoiyIiIgogICAgICAgIHNlbGYuZW5jb2Rlcl90aHJlYWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl9zZW5kX2VuY29kZXJfbG9vcCkKICAgICAgICBzZWxmLmVuY29kZXJfdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICBzZWxmLmVuY29kZXJfdGhyZWFkLnN0YXJ0KCkKICAgICAgICAjIHByaW50KCLnvJbnoIHlmajlvqrnjq/nur/nqIvlt7LlkK/liqgiKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9zdGFydF90YWN0aWxlX2xvb3Aoc2VsZik6CiAgICAgICAgIiIi5q2j56Gu5ZCv5Yqo6Kem6KeJ5b6q546v57q/56iLIiIiCiAgICAgICAgc2VsZi50YWN0aWxlX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3NlbmRfdGFjdGlsZV9sb29wKQogICAgICAgIHNlbGYudGFjdGlsZV90aHJlYWQuZGFlbW9uID0gVHJ1ZQogICAgICAgIHNlbGYudGFjdGlsZV90aHJlYWQuc3RhcnQoKQogICAgICAgICMgcHJpbnQoIuinpuinieW+queOr+e6v+eoi+W3suWQr+WKqCIpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX3N0YXJ0X3NlbmRpbmcoc2VsZik6CiAgICAgICAgc2VsZi5zZW5kX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3NlbmRpbmdfbG9vcCkKICAgICAgICBzZWxmLnNlbmRfdGhyZWFkLmRhZW1vbiA9IFRydWUKICAgICAgICBzZWxmLnNlbmRfdGhyZWFkLnN0YXJ0KCkKICAgICAgICAjIHByaW50KCLlj5HpgIHnur/nqIvlt7LlkK/liqgiKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9zZW5kaW5nX2xvb3Aoc2VsZik6CiAgICAgICAgIiIi5Y+R6YCB57q/56iL5Li75b6q546vIiIiCiAgICAgICAgd2hpbGUgc2VsZi5pc19ydW5uaW5nIGFuZCBub3Qgcm9zcHkuaXNfc2h1dGRvd24oKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY21kOiBDbWRQYWNrID0gc2VsZi5jbWRfcXVldWUuZ2V0KGJsb2NrPVRydWUsIHRpbWVvdXQ9MC4xKQogICAgICAgICAgICAgICAgd2l0aCBzZWxmLnNlcmlhbF9sb2NrOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc2VyIGFuZCBzZWxmLnNlci5pc19vcGVuOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNlci53cml0ZShjbWQuZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXIuZmx1c2goKQogICAgICAgICAgICAgICAgICAgICAgICAjIHByaW50KGYi5Y+R6YCB5ZG95LukOiB7Y21kLmRhdGF9LCDpmJ/liJfliankvZk6IHtzZWxmLmNtZF9xdWV1ZS5xc2l6ZSgpfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IHF1ZXVlLkVtcHR5OgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiLlj5HpgIHplJnor686IHtlfSIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMDEpCgogICAgICAgIHByaW50KCLpgIDlh7rlj5HpgIHnur/nqIsiKQoKICAgIGRlZiBfcmVhZGluZ19sb29wKHNlbGYpOgogICAgICAgICIiIuivu+WPlue6v+eoi+S4u+W+queOryIiIgogICAgICAgIHdoaWxlIHNlbGYuaXNfcnVubmluZyBhbmQgbm90IHJvc3B5LmlzX3NodXRkb3duKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggc2VsZi5zZXJpYWxfbG9jazoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnNlciBhbmQgc2VsZi5zZXIuaXNfb3BlbjoKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHNlbGYuc2VyLmluV2FpdGluZygpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG46CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gc2VsZi5zZXIucmVhZChuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBzZWxmLmRhdGFfYnVmZmVyX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kYXRhX2J1ZmZlciA9IHNlbGYuZGF0YV9idWZmZXIgKyBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBwcmludChmIuivu+WPluWIsOaVsOaNrjoge2xlbihkYXRhKX0g5a2X6IqCLCDnvJPlhrLljLrmgLvplb86IHtsZW4oc2VsZi5kYXRhX2J1ZmZlcil9IikKCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYi6K+75Y+W5b6q546v6ZSZ6K+vOiB7ZX0iKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjEpCgogICAgICAgICAgICB0aW1lLnNsZWVwKDAuMDAxKSAgIyDnn63mmoLkvJHnnKDpgb/lhY3ov4fluqbljaDnlKhDUFUKCiAgICAgICAgcHJpbnQoIumAgOWHuuivu+WPlue6v+eoiyIpCgogICAgZGVmIF9wYXJzaW5nX2xvb3Aoc2VsZik6CiAgICAgICAgIiIi6Kej5p6Q57q/56iL5Li75b6q546vIC0g546w5Zyo5ZCM5pe25aSE55CG5aSa56eN5pWw5o2u5YyF57G75Z6LIiIiCiAgICAgICAgd2hpbGUgc2VsZi5pc19ydW5uaW5nIGFuZCBub3Qgcm9zcHkuaXNfc2h1dGRvd24oKToKICAgICAgICAgICAgd2l0aCBzZWxmLmRhdGFfYnVmZmVyX2xvY2s6CiAgICAgICAgICAgICAgICBpZiBsZW4oc2VsZi5kYXRhX2J1ZmZlcikgPiAwOgogICAgICAgICAgICAgICAgICAgICMgcHJpbnQoZiLop6PmnpDmlbDmja7nvJPlhrLljLo6IHtsZW4oc2VsZi5kYXRhX2J1ZmZlcil9IOWtl+iKgiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDlhbPplK7kv67lpI3vvJrkvb/nlKjlrp7kvovljJbnmoRwcm90b2NvbOWvueixoeadpeiwg+eUqGZpbmRfcGFja2V0CiAgICAgICAgICAgICAgICAgICAgcGFja2V0cywgcmVtYWluID0gREFTUHJvdG9jb2wuZmluZF9wYWNrZXQoc2VsZi5kYXRhX2J1ZmZlcikKICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGFfYnVmZmVyID0gcmVtYWluCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBwcmludCgicGFja2V0c19iaWFvZGluZzogIiwgcGFja2V0cykKICAgICAgICAgICAgICAgICAgICBmb3IgcGFja2V0IGluIHBhY2tldHM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfY2FsaWJfY21kOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoInBhY2tldDogIiwgcGFja2V0KSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYV9wYWNrID0gTWVzc2FnZVBhY2sudW5wYWNrX2NhbWVyYV9jYWxpYihwYWNrZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhbWVyYV9wYWNrOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQoZiJjYW1lcmFfcGFjayByZWNlaXZlZDoge2NhbWVyYV9wYWNrfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDlpITnkIbmkYTlg4/lpLTmoIflrprmlbDmja4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmNhbWVyYV9jYWxpYl9jYWxsYmFjazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYW1lcmFfY2FsaWJfY2FsbGJhY2soY2FtZXJhX3BhY2spCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyDmlLbliLDmoIflrprlk43lupTlkI7lj6/ku6Xph43nva7moIflv5fvvIjlj6/pgInvvIkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmlzX2NhbGliX2NtZCA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrID0gTWVzc2FnZVBhY2sudW5wYWNrKHBhY2tldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQoInBhY2tfbm9ybWFsOiAiLCBwYWNrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHBhY2s6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcmVjb3JkIGluIHBhY2sucmVjb3Jkc186CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVjb3JkLnJlY29yZF90eXBlID09IFJlY29yZFR5cGUuVGFjdGlsZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50YWN0aWxlX2NhbGxiYWNrKHJlY29yZC5yZWNvcmRfZGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIHJlY29yZC5yZWNvcmRfdHlwZSA9PSBSZWNvcmRUeXBlLkVuY29kZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW5jb2Rlcl9jYWxsYmFjayhyZWNvcmQucmVjb3JkX2RhdGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiByZWNvcmQucmVjb3JkX3R5cGUgPT0gUmVjb3JkVHlwZS5FY2hvOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmVjaG9fY2FsbGJhY2socmVjb3JkLnJlY29yZF9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcuZXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicmVjb3JkIHR5cGU6e30gaW52YWxpZCAhIi5mb3JtYXQocmVjb3JkLnJlY29yZF90eXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICB0aW1lLnNsZWVwKDAuMDEpICAjIOmBv+WFjei/h+W6puWNoOeUqENQVQoKICAgICAgICBwcmludCgi6YCA5Ye66Kej5p6Q57q/56iLIikKCiAgICBkZWYgX3NlbmRfZW5jb2Rlcl9sb29wKHNlbGYpOgogICAgICAgICIiIue8lueggeWZqOW+queOr+e6v+eoiyAtIOS9v+eUqFJPU+iuoumYheeahOeUteacuuinkuW6piIiIgogICAgICAgIGlmIG5vdCBzZWxmLmVuY29kZXJfZnJlcToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIGludGVydmFsID0gMS4wIC8gc2VsZi5lbmNvZGVyX2ZyZXEKICAgICAgICAjIHByaW50KGYi57yW56CB5Zmo5b6q546v5ZCv5Yqo77yM6aKR546HOiB7c2VsZi5lbmNvZGVyX2ZyZXF9SHosIOmXtOmalDoge2ludGVydmFsOi4zZn1zIikKICAgICAgICAKICAgICAgICB3aGlsZSBzZWxmLmlzX3J1bm5pbmcgYW5kIG5vdCByb3NweS5pc19zaHV0ZG93bigpOgogICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5LiL5Y+R6Led56a75oyH5Luk5Yiw55S15py6CiAgICAgICAgICAgIHdpdGggc2VsZi5hbmdsZV9sb2NrOgogICAgICAgICAgICAgICAgZGlzX3RhcmdldCA9IHNlbGYuZ3JpcHBlcl9kaXMKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuYWRkX2NtZCgKICAgICAgICAgICAgICAgIENtZFBhY2sucGFjaygKICAgICAgICAgICAgICAgICAgICBvcGNvZGU9T3Bjb2RlLlJlYWRCYXRjaCwgCiAgICAgICAgICAgICAgICAgICAgcmVjb3JkX3R5cGU9UmVjb3JkVHlwZS5FbmNvZGVyLCAKICAgICAgICAgICAgICAgICAgICByZWNvcmQ9c3RydWN0LnBhY2soIj5mIiwgZGlzX3RhcmdldCkKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg57K+56Gu5o6n5Yi26Ze06ZqU5pe26Ze0CiAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgc2xlZXBfdGltZSA9IG1heCgwLCBpbnRlcnZhbCAtIGVsYXBzZWQpCiAgICAgICAgICAgIGlmIHNsZWVwX3RpbWUgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChzbGVlcF90aW1lKQoKICAgICAgICBwcmludCgi6YCA5Ye657yW56CB5Zmo5b6q546v57q/56iLIikKCiAgICBkZWYgX3NlbmRfdGFjdGlsZV9sb29wKHNlbGYpOgogICAgICAgICIiIuinpuinieW+queOr+e6v+eoiyIiIgogICAgICAgIGlmIG5vdCBzZWxmLnRhY3RpbGVfZnJlcToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgIGludGVydmFsID0gMS4wIC8gc2VsZi50YWN0aWxlX2ZyZXEKICAgICAgICBwcmludChmIuinpuinieW+queOr+WQr+WKqO+8jOmikeeOhzoge3NlbGYudGFjdGlsZV9mcmVxfUh6LCDpl7TpmpQ6IHtpbnRlcnZhbDouM2Z9cyIpCiAgICAgICAgCiAgICAgICAgd2hpbGUgc2VsZi5pc19ydW5uaW5nIGFuZCBub3Qgcm9zcHkuaXNfc2h1dGRvd24oKToKICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIHNlbGYuYWRkX2NtZCgKICAgICAgICAgICAgICAgIENtZFBhY2sucGFjayhvcGNvZGU9T3Bjb2RlLlJlYWRTaW5nbGUsIHJlY29yZF90eXBlPVJlY29yZFR5cGUuVGFjdGlsZSwgcmVjb3JkPXN0cnVjdC5wYWNrKCI+ZiIsIDAuMCkpCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg57K+56Gu5o6n5Yi26Ze06ZqU5pe26Ze0CiAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgc2xlZXBfdGltZSA9IG1heCgwLCBpbnRlcnZhbCAtIGVsYXBzZWQpCiAgICAgICAgICAgIGlmIHNsZWVwX3RpbWUgPiAwOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChzbGVlcF90aW1lKQoKICAgICAgICBwcmludCgi6YCA5Ye66Kem6KeJ5b6q546v57q/56iLIikKCiAgICBkZWYgc3RvcChzZWxmKToKICAgICAgICAiIiLlgZzmraLmiYDmnInnur/nqIsiIiIKICAgICAgICBwcmludCgi5q2j5Zyo5YGc5q2i5omA5pyJ57q/56iLLi4uIikKICAgICAgICBzZWxmLmlzX3J1bm5pbmcgPSBGYWxzZQogICAgICAgIAogICAgICAgICMg562J5b6F5omA5pyJ57q/56iL57uT5p2fCiAgICAgICAgdGhyZWFkc190b19qb2luID0gW10KICAgICAgICBpZiBzZWxmLnJlYWRfdGhyZWFkIGFuZCBzZWxmLnJlYWRfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHRocmVhZHNfdG9fam9pbi5hcHBlbmQoc2VsZi5yZWFkX3RocmVhZCkKICAgICAgICBpZiBzZWxmLnNlbmRfdGhyZWFkIGFuZCBzZWxmLnNlbmRfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHRocmVhZHNfdG9fam9pbi5hcHBlbmQoc2VsZi5zZW5kX3RocmVhZCkKICAgICAgICBpZiBzZWxmLnBhcnNlX3RocmVhZCBhbmQgc2VsZi5wYXJzZV90aHJlYWQuaXNfYWxpdmUoKToKICAgICAgICAgICAgdGhyZWFkc190b19qb2luLmFwcGVuZChzZWxmLnBhcnNlX3RocmVhZCkKICAgICAgICBpZiBzZWxmLmVuY29kZXJfdGhyZWFkIGFuZCBzZWxmLmVuY29kZXJfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHRocmVhZHNfdG9fam9pbi5hcHBlbmQoc2VsZi5lbmNvZGVyX3RocmVhZCkKICAgICAgICBpZiBzZWxmLnRhY3RpbGVfdGhyZWFkIGFuZCBzZWxmLnRhY3RpbGVfdGhyZWFkLmlzX2FsaXZlKCk6CiAgICAgICAgICAgIHRocmVhZHNfdG9fam9pbi5hcHBlbmQoc2VsZi50YWN0aWxlX3RocmVhZCkKICAgICAgICAKICAgICAgICBmb3IgdGhyZWFkIGluIHRocmVhZHNfdG9fam9pbjoKICAgICAgICAgICAgdGhyZWFkLmpvaW4odGltZW91dD0yKQogICAgICAgICAgICBwcmludChmIue6v+eoiyB7dGhyZWFkLm5hbWV9IOW3suWBnOatoiIpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5zZXIgYW5kIHNlbGYuc2VyLmlzX29wZW46CiAgICAgICAgICAgIHNlbGYuc2VyLmNsb3NlKCkKICAgICAgICAgICAgcHJpbnQoIuS4suWPo+W3suWFs+mXrSIpCiAgICAgICAgCiAgICAgICAgcHJpbnQoIuaJgOaciee6v+eoi+W3suWBnOatoiIpCgogICAgZGVmIGdldF9zZXJpYWxfaW5mbyhzZWxmKToKICAgICAgICAiIiLojrflj5bkuLLlj6Pkv6Hmga8iIiIKICAgICAgICBpZiBzZWxmLnNlciBhbmQgc2VsZi5zZXIuaXNfb3BlbjoKICAgICAgICAgICAgaW5mbyA9IHsKICAgICAgICAgICAgICAgICJ0dHlfcG9ydCI6IHNlbGYudHR5X3BvcnQsICAjIOS/ruato++8muS9v+eUqOWtmOWCqOeahOerr+WPo+WQjQogICAgICAgICAgICAgICAgImJhdWRyYXRlIjogc2VsZi5zZXIuYmF1ZHJhdGUsCiAgICAgICAgICAgICAgICAiYnl0ZXNpemUiOiBzZWxmLnNlci5ieXRlc2l6ZSwKICAgICAgICAgICAgICAgICJwYXJpdHkiOiBzZWxmLnNlci5wYXJpdHksCiAgICAgICAgICAgICAgICAic3RvcGJpdHMiOiBzZWxmLnNlci5zdG9wYml0cywKICAgICAgICAgICAgICAgICJ0aW1lb3V0Ijogc2VsZi5zZXIudGltZW91dCwKICAgICAgICAgICAgICAgICJpbl93YWl0aW5nIjogc2VsZi5zZXIuaW5fd2FpdGluZywKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5mbwogICAgICAgIHJldHVybiBOb25lCgpkZWYgY2hlY2tfYW5kX2ZpeF9wZXJtaXNzaW9uKHBvcnQpOgogICAgIiIi5qOA5p+l5bm25L+u5aSN5Liy5Y+j6K6+5aSH5p2D6ZmQIiIiCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocG9ydCk6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgICMg5qOA5p+l5b2T5YmN55So5oi35piv5ZCm5pyJ6K+75YaZ5p2D6ZmQCiAgICBpZiBvcy5hY2Nlc3MocG9ydCwgb3MuUl9PSyB8IG9zLldfT0spOgogICAgICAgIHJldHVybiBUcnVlCiAgICAKICAgIHByaW50KGYi5bCd6K+V5L+u5aSNIHtwb3J0fSDnmoTmnYPpmZAuLi4iKQogICAgdHJ5OgogICAgICAgICMg5bCd6K+V5L+u5pS55p2D6ZmQCiAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ2NobW9kJywgJzY2NicsIHBvcnRdLCBjaGVjaz1UcnVlKQogICAgICAgIHByaW50KGYi5p2D6ZmQ5L+u5aSN5oiQ5YqfOiB7cG9ydH0iKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3I6CiAgICAgICAgcHJpbnQoZiLmnYPpmZDkv67lpI3lpLHotKXvvIzor7fmiYvliqjmiafooYw6IHN1ZG8gY2htb2QgNjY2IHtwb3J0fSIpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgZmluZF9zZXJpYWxfcG9ydChwYXR0ZXJuPSJ0dHlVU0IiLCBtYXhfcmV0cmllcz0zLCByZXRyeV9pbnRlcnZhbD0yLCBzaWRlPU5vbmUpOgogICAgIiIiCiAgICDoh6rliqjmn6Xmib7ljLnphY3mqKHlvI/nmoTkuLLlj6Porr7lpIfvvIzmlK/mjIHph43or5XmnLrliLYKICAgIHNpZGU6ICdsZWZ0JyDmiJYgJ3JpZ2h0J++8jOeUqOS6juaMh+WumuW3puWPs+iuvuWkhwogICAgIiIiCiAgICAjIOmmluWFiOajgOafpeaYr+WQpuacieaYoOWwhOeahOiuvuWkhwogICAgaWYgc2lkZSA9PSAibGVmdCI6CiAgICAgICAgbGVmdF9wb3J0ID0gIi9kZXYvdHR5RGV2aWNlTGVmdCIKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsZWZ0X3BvcnQpOgogICAgICAgICAgICBpZiBjaGVja19hbmRfZml4X3Blcm1pc3Npb24obGVmdF9wb3J0KToKICAgICAgICAgICAgICAgIHByaW50KGYi5L2/55So5bem5L6n5pig5bCE6K6+5aSHOiB7bGVmdF9wb3J0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdF9wb3J0CiAgICBlbGlmIHNpZGUgPT0gInJpZ2h0IjoKICAgICAgICByaWdodF9wb3J0ID0gIi9kZXYvdHR5RGV2aWNlUmlnaHQiCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocmlnaHRfcG9ydCk6CiAgICAgICAgICAgIGlmIGNoZWNrX2FuZF9maXhfcGVybWlzc2lvbihyaWdodF9wb3J0KToKICAgICAgICAgICAgICAgIHByaW50KGYi5L2/55So5Y+z5L6n5pig5bCE6K6+5aSHOiB7cmlnaHRfcG9ydH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIHJpZ2h0X3BvcnQKICAgIAogICAgIyDlpoLmnpzmjIflrprkuoZzaWRl5L2G5rKh5pyJ5pig5bCE6K6+5aSH77yM57un57ut6Ieq5Yqo5p+l5om+CiAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgcG9ydHMgPSBsaXN0KHNlcmlhbC50b29scy5saXN0X3BvcnRzLmNvbXBvcnRzKCkpCiAgICAgICAgCiAgICAgICAgbWF0Y2hpbmdfcG9ydHMgPSBbXQogICAgICAgIGZvciBwb3J0IGluIHBvcnRzOgogICAgICAgICAgICBpZiBwYXR0ZXJuIGluIHBvcnQuZGV2aWNlOgogICAgICAgICAgICAgICAgbWF0Y2hpbmdfcG9ydHMuYXBwZW5kKHBvcnQuZGV2aWNlKQogICAgICAgIAogICAgICAgICMg5oyJ5pWw5a2X5ZCO57yA5o6S5bqPCiAgICAgICAgbWF0Y2hpbmdfcG9ydHMuc29ydChrZXk9bGFtYmRhIHg6IGludCh4LnJlcGxhY2UoZiIvZGV2L3twYXR0ZXJufSIsICIiKSkgaWYgeC5yZXBsYWNlKGYiL2Rldi97cGF0dGVybn0iLCAiIikuaXNkaWdpdCgpIGVsc2UgLTEpCiAgICAgICAgCiAgICAgICAgaWYgbWF0Y2hpbmdfcG9ydHM6CiAgICAgICAgICAgIHByaW50KGYi5om+5Yiw5Liy5Y+j6K6+5aSHOiB7bWF0Y2hpbmdfcG9ydHN9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg5aaC5p6c5oyH5a6a5LqGc2lkZe+8jOS9huaYoOWwhOiuvuWkh+S4jeWtmOWcqO+8jOS9v+eUqOesrOS4gOS4quaJvuWIsOeahOiuvuWkhwogICAgICAgICAgICBpZiBzaWRlOgogICAgICAgICAgICAgICAgcHJpbnQoZiLorablkYo6IOayoeacieaJvuWIsHtzaWRlfeaYoOWwhOiuvuWkh++8jOS9v+eUqOiHquWKqOajgOa1i+WIsOeahOesrOS4gOS4quiuvuWkhyIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIOajgOafpeadg+mZkOW5tui/lOWbnuesrOS4gOS4quacieadg+mZkOeahOiuvuWkhwogICAgICAgICAgICBmb3IgcG9ydCBpbiBtYXRjaGluZ19wb3J0czoKICAgICAgICAgICAgICAgIGlmIGNoZWNrX2FuZF9maXhfcGVybWlzc2lvbihwb3J0KToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9ydAogICAgICAgICAgICAjIOWmguaenOmDveayoeacieadg+mZkO+8jOi/lOWbnuesrOS4gOS4quiuvuWkh++8iOeUqOaIt+mcgOimgeaJi+WKqOWkhOeQhuadg+mZkO+8iQogICAgICAgICAgICByZXR1cm4gbWF0Y2hpbmdfcG9ydHNbLTFdCiAgICAgICAgCiAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgcHJpbnQoZiLnrKx7YXR0ZW1wdCArIDF95qyh5pyq5om+5Yiw5Liy5Y+j6K6+5aSH77yMe3JldHJ5X2ludGVydmFsfeenkuWQjumHjeivlS4uLiIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAocmV0cnlfaW50ZXJ2YWwpCiAgICAKICAgIHByaW50KGYi57uP6L+He21heF9yZXRyaWVzfeasoeWwneivleWQjuS7jeacquaJvuWIsOS4suWPo+iuvuWkhyIpCiAgICByZXR1cm4gTm9uZQoKZGVmIG1haW4oKToKICAgICMg6L+H5rukUk9T6Ieq5Yqo5re75Yqg55qE5Y+C5pWwCiAgICByb3NfYXJncyA9IFsnX19uYW1lOj0nLCAnX19sb2c6PScsICdfX21hc3Rlcjo9JywgJ19faXA6PSddCiAgICBmaWx0ZXJlZF9hcmdzID0gW10KICAgIAogICAgZm9yIGFyZyBpbiBzeXMuYXJndlsxOl06CiAgICAgICAgaWYgbm90IGFueShhcmcuc3RhcnRzd2l0aChyb3NfYXJnKSBmb3Igcm9zX2FyZyBpbiByb3NfYXJncyk6CiAgICAgICAgICAgIGZpbHRlcmVkX2FyZ3MuYXBwZW5kKGFyZykKICAgIAogICAgc3lzLmFyZ3YgPSBbc3lzLmFyZ3ZbMF1dICsgZmlsdGVyZWRfYXJncwogICAgCiAgICAjIOino+aekOWRveS7pOihjOWPguaVsAogICAgaW1wb3J0IGFyZ3BhcnNlCiAgICBwYXJzZXIgPSBhcmdwYXJzZS5Bcmd1bWVudFBhcnNlcihkZXNjcmlwdGlvbj0iREFTIGludGVyZmFjZSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXNlcmlhbC1wb3J0IiwgdHlwZT1zdHIsIGRlZmF1bHQ9IiIsIAogICAgICAgICAgICAgICAgICAgICAgIGhlbHA9IlNlcmlhbCBwb3J0IGRldmljZSAoZS5nLiwgL2Rldi90dHlVU0IwKSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLWNhbWVyYS1jbWQiLCB0eXBlPXN0ciwgZGVmYXVsdD0iIiwKICAgICAgICAgICAgICAgICAgICAgICBoZWxwPSJDYW1lcmEgY2FsaWJyYXRpb24gY29tbWFuZCAoZS5nLiwgJ01DVUlEJyBmb3IgY2FtZXJhIElEIHF1ZXJ5KSIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItLXNpZGUiLCB0eXBlPXN0ciwgZGVmYXVsdD0iIiwgY2hvaWNlcz1bImxlZnQiLCAicmlnaHQiXSwKICAgICAgICAgICAgICAgICAgICAgICBoZWxwPSJEZXZpY2Ugc2lkZTogbGVmdCBvciByaWdodCAodXNlcyBtYXBwZWQgcG9ydHMpIikKICAgIGFyZ3MsIHVua25vd24gPSBwYXJzZXIucGFyc2Vfa25vd25fYXJncygpCiAgICAKICAgICMg5LyY5YWI5L2/55So5ZG95Luk6KGM5Y+C5pWwCiAgICBzaWRlID0gYXJncy5zaWRlCiAgICAKICAgICMg5YW25qyh5LuOUk9T5Y+C5pWw6I635Y+WCiAgICBpZiBub3Qgc2lkZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJvc3B5LmluaXRfbm9kZSgnZGFzX3Jvc19pbnRlcmZhY2UnLCBhbm9ueW1vdXM9VHJ1ZSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICBzaWRlID0gcm9zcHkuZ2V0X3BhcmFtKCd+c2lkZScsICcnKQogICAgCiAgICAjIOS4suWPo+mAieaLqemAu+i+kQogICAgc2VyaWFsX3BvcnQgPSBOb25lCiAgICBpZiBhcmdzLnNlcmlhbF9wb3J0IGFuZCBhcmdzLnNlcmlhbF9wb3J0ICE9ICIiOgogICAgICAgIHNlcmlhbF9wb3J0ID0gYXJncy5zZXJpYWxfcG9ydAogICAgICAgIHByaW50KGYi5L2/55So5ZG95Luk6KGM5oyH5a6a55qE5Liy5Y+jOiB7c2VyaWFsX3BvcnR9IikKICAgIGVsaWYgc2lkZToKICAgICAgICAjIOWmguaenOacieaMh+WumnNpZGXvvIzkvb/nlKjmmKDlsITnmoTorr7lpIcKICAgICAgICBpZiBzaWRlID09ICJsZWZ0IjoKICAgICAgICAgICAgc2VyaWFsX3BvcnQgPSAiL2Rldi90dHlEZXZpY2VMZWZ0IgogICAgICAgIGVsaWYgc2lkZSA9PSAicmlnaHQiOgogICAgICAgICAgICBzZXJpYWxfcG9ydCA9ICIvZGV2L3R0eURldmljZVJpZ2h0IgogICAgICAgIHByaW50KGYi5L2/55Soe3NpZGV95L6n5pig5bCE6K6+5aSHOiB7c2VyaWFsX3BvcnR9IikKICAgIGVsc2U6CiAgICAgICAgIyDlsJ3or5Xku45ST1Plj4LmlbDojrflj5YKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCByb3NweS5jb3JlLmlzX2luaXRpYWxpemVkKCk6CiAgICAgICAgICAgICAgICByb3NweS5pbml0X25vZGUoJ2Rhc19yb3NfaW50ZXJmYWNlJywgYW5vbnltb3VzPVRydWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgc2VyaWFsX3BvcnQgPSByb3NweS5nZXRfcGFyYW0oJ35zZXJpYWxfcG9ydCcsICcnKQogICAgICAgIGlmIHNlcmlhbF9wb3J0IGFuZCBzZXJpYWxfcG9ydCAhPSAiIjoKICAgICAgICAgICAgIyBwcmludChmIuS9v+eUqFJPU+WPguaVsOaMh+WumueahOS4suWPozoge3NlcmlhbF9wb3J0fSIpCiAgICAgICAgICAgIHBhc3MKICAgICMg6Ieq5Yqo5p+l5om+5Liy5Y+jCiAgICBpZiBub3Qgc2VyaWFsX3BvcnQgb3Igc2VyaWFsX3BvcnQgPT0gIiI6CiAgICAgICAgc2VyaWFsX3BvcnQgPSBmaW5kX3NlcmlhbF9wb3J0KCJ0dHlVU0IiLCBzaWRlPXNpZGUpCiAgICAgICAgaWYgc2VyaWFsX3BvcnQgaXMgTm9uZToKICAgICAgICAgICAgIyBwcmludCgi4p2MIOacquaJvuWIsOWPr+eUqOeahOS4suWPo+iuvuWkh++8jOivt+ajgOafpeiuvuWkh+aYr+WQpuato+ehruaPkuWFpSIpCiAgICAgICAgICAgIHJldHVybgogICAgCiAgICAjIHByaW50KGYi5pyA57uI5L2/55So55qE5Liy5Y+jOiB7c2VyaWFsX3BvcnR9IikKICAgIAogICAgIyDliJvlu7pEYXRhQnVz5a6e5L6LCiAgICBidXMgPSBEYXRhQnVzKAogICAgICAgIHR0eV9wb3J0PXNlcmlhbF9wb3J0LAogICAgICAgIGJhdWRyYXRlPTkyMTYwMCwKICAgICAgICBlbmNvZGVyX2ZyZXE9NTAsCiAgICAgICAgaXNfY2FsaWJfY21kPUZhbHNlLAogICAgKQoKICAgICMg57uZ6K6+5aSH5LiA5Lqb5Yid5aeL5YyW5pe26Ze0CiAgICB0aW1lLnNsZWVwKDEpCiAgICAKICAgICMg5aaC5p6c5pyJ5pGE5YOP5aS05ZG95Luk5Y+C5pWw77yM5Y+R6YCB5pGE5YOP5aS05qCH5a6a5ZG95LukCiAgICBpZiBhcmdzLmNhbWVyYV9jbWQgYW5kIGFyZ3MuY2FtZXJhX2NtZCAhPSAiIjoKICAgICAgICAjIGJ1cy5pc19jYWxpYl9jbWQgPSBUcnVlICAjIOiuvue9ruagh+WumuaooeW8j+agh+W/lwogICAgICAgIHByaW50KGYi5Y+R6YCB5pGE5YOP5aS05qCH5a6a5ZG95LukOiB7YXJncy5jYW1lcmFfY21kfSIpCiAgICAgICAgYnVzLnNlbmRfY2FtZXJhX2NhbGliX2NtZChhcmdzLmNhbWVyYV9jbWQpCiAgICAKICAgIHRyeToKICAgICAgICAjIOS9v+eUqFJPU+eahHNwaW7mnaXkv53mjIHoioLngrnov5DooYwKICAgICAgICBwcmludChmIlxu4pyFIOiuvuWkh+WIneWni+WMluWujOaIkO+8jHtzaWRlIGlmIHNpZGUgZWxzZSAn5Y2VJ33orr7lpIfmraPluLjov5DooYzkuK3vvIjmjIlDdHJsK0PpgIDlh7rvvIkuLi4iKQogICAgICAgIHJvc3B5LnNwaW4oKQogICAgICAgICAgICAKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwcmludCgiXG7wn5uRIOeUqOaIt+S4reaWreeoi+W6jyIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJcbuKdjCDlj5HnlJ/plJnor686IHtlfSIpCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICBmaW5hbGx5OgogICAgICAgIHByaW50KCJcbvCflIwg5q2j5Zyo5YGc5q2i6K6+5aSH5bm25YWz6Zet5Liy5Y+jLi4uIikKICAgICAgICBidXMuc3RvcCgpCiAgICAgICAgcHJpbnQoIuKchSDnqIvluo/lt7LlronlhajpgIDlh7oiKQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKSA=
'''

def _decode_and_execute():
  """解码并执行源码，返回模块的全局命名空间"""
  try:
    # 解码源码
    source_code = base64.b64decode(ENCODED_SOURCE).decode('utf-8')
    
    # 编译源码
    code = compile(source_code, 'databus_single.py', 'exec')
    
    # 创建命名空间
    import builtins
    globals_dict = {
      '__name__': 'databus_single',
      '__file__': __file__,
      '__package__': None,
      '__builtins__': builtins,
    }
    
    # 执行编译后的代码
    exec(code, globals_dict)
    
    return globals_dict
  except Exception as e:
    print(f"解码错误: {e}")
    import traceback
    traceback.print_exc()
    raise

# 解码并获取原始模块的全局命名空间
_original_globals = _decode_and_execute()

# ✅ 关键修复：导出原始模块的所有非私有符号
for name, value in _original_globals.items():
  if not name.startswith('_') and name not in globals():
    globals()[name] = value

# ✅ 特殊导出：确保DataBus和find_serial_port可导入
if 'DataBus' in _original_globals:
  DataBus = _original_globals['DataBus']
  globals()['DataBus'] = DataBus
  __all__.append('DataBus') if '__all__' in globals() else None

if 'find_serial_port' in _original_globals:
  find_serial_port = _original_globals['find_serial_port']
  globals()['find_serial_port'] = find_serial_port
  __all__.append('find_serial_port') if '__all__' in globals() else None

# ✅ 定义main函数，用于脚本执行
def main():
  """主函数 - 用于脚本执行"""
  try:
    if 'main' in _original_globals:
      sys.argv[0] = 'databus_single.py'
      _original_globals['main']()
    else:
      print("错误: 找不到main函数")
      sys.exit(1)
  except Exception as e:
    print(f"执行错误: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)

# 定义__all__列表
__all__ = []
for name in _original_globals.keys():
  if not name.startswith('_'):
    __all__.append(name)
globals()['__all__'] = __all__

if __name__ == '__main__':
  main()
